# 開発依頼書_最終ポリッシュ_会話演出とクリエイター機能の完成

**宛先**: AI開発エンジニア  
**差出人**: プロジェクトマネージャー (Gemini)  
**依頼日**: 2025年7月1日

## 1. 背景・目的

インタラクティブ会話劇システムの実装は成功し、アプリケーションのコア体験は完成した。本依頼の目的は、オーナーからの最終フィードバックに基づき、会話の「間」を演出することでユーザー体験を向上させ、クリエイター向け支援機能（プロンプト編集、キャラクター設定）を完全な形に仕上げることである。

## 2. 依頼タスク一覧

以下の3つのタスクを実装し、アプリケーションを完成させよ。

### Task 1: 会話演出の改善（会話の「間」の実装）

**現状の問題**: 連続メッセージが表示される際、待ち時間が常に一定であるため、文章の長さを考慮した自然な「読む時間」が確保できていない。

**実装方針**:

1. `hooks/useGameLogic.ts`内の連続メッセージを処理するuseEffectのロジックを改修する。

2. 次のメッセージを表示するまでの待ち時間（setTimeoutの遅延時間）を、固定値（例: 1500ms）から、表示されたメッセージの文字数に応じた動的な値に変更する。

3. 計算式は**「基本待ち時間 + 文字数 × 1文字あたりの追加時間」**とする。例えば、`1200 + (message.text.length * 50)` のように設定し、最低でも1.2秒、長い文章ほど待つように調整せよ。（ms単位）

**受入基準**: 短いセリフはテンポよく、長いナレーションの後にはしっかりと、メッセージの長さに応じて適切な「間」が生まれること。

### Task 2: システムプロンプト編集機能の完全統合

**現状の問題**: AIへの指示（システムプロンプト）の根幹部分が`hooks/useGameLogic.ts`内にハードコードされており、GUIの「システムプロンプト編集」機能が、その一部しか編集できない形骸化したものになっている。

**実装方針**:

1. `hooks/useGameLogic.ts`内の`createGamePrompt`関数から、ハードコードされたプロンプトのテンプレート文字列を完全に削除する。

2. その削除したテンプレート文字列を、**`components/SystemPromptEditor.tsx`コンポーネントの初期値（デフォルト値）**として設定する。

3. `createGamePrompt`関数は、常に`settings.systemPromptTemplate`から渡されるテンプレート文字列を元にプロンプトを生成するように改修する。これにより、GUIのエディタが、AIへの指示の**唯一かつ絶対的な情報源（Single Source of Truth）**となる。

**受入基準**: 「システムプロンプト編集」画面で編集した内容（例えば### 特別な指示の部分の文章など）が、即座にAIの挙動に反映されること。

### Task 3: キャラクター設定項目の追加

**現状の問題**: キャラクター設定画面に、キャラクターの性格や口調、背景設定などを記述する欄が存在しない。

**実装方針**:

1. **UIの改修**: `components/CharacterEditor.tsx`を編集し、「別名・呼び方」の下に**「キャラクターの性格・設定」**というタイトルの、複数行入力が可能な`<textarea>`（テキストエリア）を追加する。

2. **データ構造の更新**: キャラクターのデータオブジェクトに、この新しい設定を保存するための`profile`（または`description`）プロパティを追加する。

3. **プロンプトへの反映**: `hooks/useGameLogic.ts`内の`createGamePrompt`関数を改修し、`{characterList}`のプレースホルダーに、各キャラクターの`profile`の内容も含まれるようにする。

**出力例**:
```
- アキラ (別名: ...)
  - 性格・設定: 冷静沈着だが、仲間思いの一面も。古代文明の謎を追っている。
```

**受入基準**: キャラクター設定画面で入力した性格がAIに正しく伝わり、キャラクターの言動にその設定が反映されること。